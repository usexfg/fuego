<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fuego Wallet</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      color: #ffffff;
      height: 100vh;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      padding: 20px 30px;
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 107, 53, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
    }

    .fire-icon {
      font-size: 32px;
    }

    .node-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      opacity: 0.8;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #666;
      transition: all 0.3s;
    }

    .status-dot.active {
      background: #4CAF50;
      box-shadow: 0 0 10px #4CAF50;
    }

    main {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .tabs {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .tab:hover {
      color: rgba(255, 255, 255, 0.9);
    }

    .tab.active {
      color: #FF6B35;
      border-bottom-color: #FF6B35;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .balance-card {
      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 10px 40px rgba(255, 107, 53, 0.3);
    }

    .balance-label {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 8px;
    }

    .balance-amount {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .balance-usd {
      font-size: 18px;
      opacity: 0.8;
    }

    .address-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .address-label {
      font-size: 12px;
      opacity: 0.6;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .address-display {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .address-text {
      flex: 1;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      word-break: break-all;
      padding: 12px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
      color: white;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: white;
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 12px;
    }

    .actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 30px;
    }

    .send-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .form-input {
      width: 100%;
      padding: 14px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: white;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #FF6B35;
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
    }

    .transaction-list {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
    }

    .transaction-item {
      padding: 16px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .tx-info {
      flex: 1;
    }

    .tx-hash {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #FF6B35;
      margin-bottom: 4px;
    }

    .tx-details {
      font-size: 11px;
      opacity: 0.7;
    }

    .tx-amount {
      font-size: 18px;
      font-weight: 600;
    }

    .tx-amount.positive {
      color: #4CAF50;
    }

    .tx-amount.negative {
      color: #e74c3c;
    }

    .logs {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 12px;
      padding: 20px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      line-height: 1.6;
    }

    .log-entry {
      opacity: 0.7;
      margin-bottom: 4px;
    }

    .status-bar {
      padding: 12px 30px;
      background: rgba(0, 0, 0, 0.3);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
      opacity: 0.7;
    }

    .hidden {
      display: none;
    }

    .backup-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .backup-warning {
      background: rgba(231, 76, 60, 0.1);
      border-left: 4px solid #e74c3c;
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 4px;
    }

    .seed-display {
      background: rgba(0, 0, 0, 0.3);
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      word-break: break-all;
      margin: 16px 0;
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 107, 53, 0.5);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 107, 53, 0.7);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <span class="fire-icon">üî•</span>
        <span>Fuego Wallet</span>
      </div>
      <div class="node-status">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Node Offline</span>
      </div>
    </header>

    <main>
      <div class="tabs">
        <button class="tab active" onclick="switchTab('wallet')">Wallet</button>
        <button class="tab" onclick="switchTab('send')">Send</button>
        <button class="tab" onclick="switchTab('transactions')">Transactions</button>
        <button class="tab" onclick="switchTab('burn2mint')">Mint HEAT</button>
        <button class="tab" onclick="switchTab('banking')">Banking</button>
        <button class="tab" onclick="switchTab('backup')">Backup</button>
        <button class="tab" onclick="switchTab('settings')">Settings</button>
      </div>

      <!-- Wallet Tab -->
      <div id="wallet-tab" class="tab-content active">
        <div class="balance-card">
          <div class="balance-label">Total Balance</div>
          <div class="balance-amount" id="balanceAmount">0.00 XFG</div>
          <div class="balance-usd" id="balanceLocked">Locked: 0.00 XFG</div>
        </div>

        <div class="address-section">
          <div class="address-label">Your Address</div>
          <div class="address-display">
            <div class="address-text" id="addressText">No wallet loaded</div>
            <button class="btn btn-secondary btn-small" onclick="copyAddress()">üìã Copy</button>
          </div>
        </div>

        <div class="actions-grid">
          <button class="btn btn-primary" onclick="startNode()">üöÄ Start Node</button>
          <button class="btn btn-secondary" onclick="createWallet()">‚ûï Create Wallet</button>
          <button class="btn btn-secondary" onclick="refresh()">üîÑ Refresh</button>
          <button class="btn btn-secondary" onclick="stopNode()">‚èπÔ∏è Stop Node</button>
        </div>
      </div>

      <!-- Send Tab -->
      <div id="send-tab" class="tab-content">
        <div class="send-section">
          <h3 style="margin-bottom: 20px;">Send XFG</h3>
          <div class="form-group">
            <label class="form-label">Recipient Address</label>
            <input type="text" class="form-input" id="sendAddress" placeholder="fuego...">
          </div>
          <div class="form-group">
            <label class="form-label">Amount (XFG)</label>
            <input type="number" class="form-input" id="sendAmount" placeholder="0.00" step="0.01">
          </div>
          <div class="form-group">
            <label class="form-label">Fee (XFG)</label>
            <input type="number" class="form-input" id="sendFee" value="0.01" step="0.001">
          </div>
          <button class="btn btn-primary" onclick="sendTransaction()" style="width: 100%;">üì§ Send Transaction</button>
        </div>
      </div>

      <!-- Transactions Tab -->
      <div id="transactions-tab" class="tab-content">
        <div class="transaction-list">
          <h3 style="margin-bottom: 20px;">Transaction History</h3>
          <div id="transactionList">
            <p style="opacity: 0.5;">No transactions yet</p>
          </div>
        </div>
      </div>

      <!-- Burn2Mint (Mint HEAT) Tab -->
      <div id="burn2mint-tab" class="tab-content">
        <div class="backup-section">
          <h3 style="margin-bottom: 20px;">üî•‚û°Ô∏èüíé Mint HEAT from XFG</h3>
          
          <div class="backup-warning">
            <strong>‚ÑπÔ∏è Burn2Mint Process:</strong> Burn XFG ‚Üí Elderfier Consensus ‚Üí Generate STARK Proof ‚Üí Submit to Arbitrum L2 ‚Üí Receive HEAT on Ethereum L1
          </div>

          <div class="form-group">
            <label class="form-label">Burn Amount</label>
            <div style="display: flex; gap: 12px; margin-bottom: 16px;">
              <button class="btn btn-secondary" onclick="setBurnAmount(0.8)">0.8 XFG (Min)</button>
              <button class="btn btn-secondary" onclick="setBurnAmount(800)">800 XFG (Large)</button>
            </div>
            <input type="number" class="form-input" id="burnAmount" placeholder="Enter amount" step="0.01">
          </div>

          <div id="burnSteps" style="margin: 20px 0;">
            <div class="form-group">
              <button class="btn btn-primary" onclick="startBurn()" style="width: 100%;">
                Step 1: Create Burn Deposit
              </button>
            </div>

            <div id="step2" class="form-group hidden">
              <button class="btn btn-primary" onclick="requestConsensus()" style="width: 100%;">
                Step 2: Request Elderfier Consensus
              </button>
            </div>

            <div id="step3" class="form-group hidden">
              <button class="btn btn-primary" onclick="generateProof()" style="width: 100%;">
                Step 3: Generate STARK Proof
              </button>
            </div>

            <div id="step4" class="form-group hidden">
              <div class="seed-display" id="proofDisplay"></div>
              <button class="btn btn-secondary" onclick="saveProof()" style="margin-top: 12px;">
                üíæ Save Proof to File
              </button>
              <p style="margin-top: 16px; opacity: 0.8; font-size: 13px;">
                üìã <strong>Next:</strong> Submit this proof to Arbitrum L2 with L1 gas fees (0.001-0.01 ETH + 20% buffer)
              </p>
            </div>
          </div>

          <h4 style="margin: 30px 0 15px;">Burn History</h4>
          <div class="transaction-list" style="max-height: 300px; overflow-y: auto;">
            <div id="burnHistoryList">
              <p style="opacity: 0.5;">No burns yet</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Banking (CD Deposits) Tab -->
      <div id="banking-tab" class="tab-content">
        <div class="backup-section">
          <h3 style="margin-bottom: 20px;">üè¶ Certificate of Deposit (CD) - Yield Deposits</h3>
          
          <div class="backup-warning" style="background: rgba(76, 175, 80, 0.1); border-left-color: #4CAF50;">
            <strong>üí∞ Earn CD Tokens:</strong> Lock your XFG for 3 months @ 8% APY and earn CD tokens. Your XFG is returned at maturity.
          </div>

          <div class="send-section">
            <h4 style="margin-bottom: 16px;">Create New CD</h4>
            
            <div class="form-group">
              <label class="form-label">Select Deposit Amount</label>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                <button class="btn btn-secondary" onclick="setCdAmount(80)">80 XFG</button>
                <button class="btn btn-secondary" onclick="setCdAmount(800)">800 XFG</button>
                <button class="btn btn-secondary" onclick="setCdAmount(8000)">8000 XFG</button>
              </div>
              <input type="number" class="form-input" id="cdAmount" placeholder="80, 800, or 8000 XFG" step="1" min="80">
            </div>

            <div class="form-group">
              <label class="form-label">Standard Term: 3 Months @ 8% APY</label>
              <div style="padding: 16px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border-left: 4px solid #4CAF50;">
                <p style="margin: 0; font-size: 14px; opacity: 0.9;">
                  üìÖ <strong>Lock Period:</strong> 3 months (90 days)<br>
                  üìà <strong>Annual Yield:</strong> 8% APY<br>
                  üíµ <strong>Minimum:</strong> 80 XFG
                </p>
              </div>
            </div>

            <div id="cdPreview" class="seed-display hidden" style="margin: 16px 0;">
              <p><strong>Deposit:</strong> <span id="cdPreviewAmount">0</span> XFG</p>
              <p><strong>Term:</strong> 3 months (8% APY)</p>
              <p><strong>CD Yield:</strong> <span id="cdPreviewInterest">0</span> CD</p>
              <p><strong>Return:</strong> <span id="cdPreviewTotal">0</span> XFG + CD yield</p>
            </div>

            <button class="btn btn-primary" onclick="createCd()" style="width: 100%;">
              üè¶ Create 3-Month CD Deposit
            </button>
          </div>

          <h4 style="margin: 30px 0 15px;">Active CD Deposits</h4>
          <div class="transaction-list">
            <div id="cdDepositsList">
              <p style="opacity: 0.5;">No active CDs</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Backup Tab -->
      <div id="backup-tab" class="tab-content">
        <div class="backup-section">
          <h3 style="margin-bottom: 20px;">Backup & Restore</h3>
          
          <div class="backup-warning">
            <strong>‚ö†Ô∏è Important:</strong> Save your seed phrase and private keys in a secure location. Anyone with access to these can control your wallet.
          </div>

          <button class="btn btn-primary" onclick="showSeed()" style="margin-bottom: 16px;">üîë Show Seed Phrase</button>
          <button class="btn btn-secondary" onclick="exportKeys()" style="margin-bottom: 16px;">üì• Export Keys</button>

          <div id="seedDisplay" class="seed-display hidden"></div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div id="settings-tab" class="tab-content">
        <div class="backup-section">
          <h3 style="margin-bottom: 20px;">Wallet Settings</h3>
          
          <div class="backup-warning">
            <strong>‚ö†Ô∏è Danger Zone:</strong> These actions cannot be undone. Make sure you have backed up your wallet first.
          </div>

          <button class="btn btn-danger" onclick="deleteWallet()">üóëÔ∏è Delete Wallet</button>
        </div>

        <div class="logs" id="logs">
          <div class="log-entry">Ready to start...</div>
        </div>
      </div>
    </main>

    <div class="status-bar">
      <div class="status-item">
        <span>Height:</span>
        <span id="blockHeight">0</span>
      </div>
      <div class="status-item">
        <span>Peers:</span>
        <span id="peerCount">0</span>
      </div>
      <div class="status-item">
        <span>Synced:</span>
        <span id="syncStatus">No</span>
      </div>
    </div>
  </div>

  <script>
    const { electronAPI } = window;

    // State
    let nodeRunning = false;
    let walletAddress = '';
    let currentTab = 'wallet';
    let currentBurnTx = null;
    let currentEldernodeProof = null;
    let currentStarkProof = null;

    // Tab switching
    function switchTab(tab) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      
      // Show selected tab
      document.getElementById(`${tab}-tab`).classList.add('active');
      event.target.classList.add('active');
      currentTab = tab;

      // Load data for specific tabs
      if (tab === 'transactions') {
        loadTransactions();
      } else if (tab === 'burn2mint') {
        loadBurnHistory();
      } else if (tab === 'banking') {
        loadCdDeposits();
      }
    }

    // Start node
    async function startNode() {
      log('Starting node...');
      const result = await electronAPI.startNode();
      log(result.message);
      
      if (result.status === 'starting' || result.status === 'already-running') {
        nodeRunning = true;
        updateNodeStatus(true);
      }
    }

    // Stop node
    async function stopNode() {
      const result = await electronAPI.stopNode();
      log(result.message);
      nodeRunning = false;
      updateNodeStatus(false);
    }

    // Create wallet
    async function createWallet() {
      log('Creating wallet...');
      const result = await electronAPI.createWallet('');
      
      if (result.status === 'created') {
        walletAddress = result.address;
        document.getElementById('addressText').textContent = walletAddress;
        log(`Wallet created: ${walletAddress}`);
        await refresh();
      } else {
        log(result.message);
      }
    }

    // Refresh balance
    async function refresh() {
      const balance = await electronAPI.getBalance();
      document.getElementById('balanceAmount').textContent = `${balance.available.toFixed(8)} XFG`;
      document.getElementById('balanceLocked').textContent = `Locked: ${balance.locked.toFixed(8)} XFG`;
      
      // Update node status
      const status = await electronAPI.getNodeStatus();
      document.getElementById('blockHeight').textContent = status.height;
      document.getElementById('peerCount').textContent = status.peers;
      document.getElementById('syncStatus').textContent = status.running ? 'Yes' : 'No';
      updateNodeStatus(status.running);
    }

    // Send transaction
    async function sendTransaction() {
      const address = document.getElementById('sendAddress').value;
      const amount = parseFloat(document.getElementById('sendAmount').value);
      const fee = parseFloat(document.getElementById('sendFee').value) || 0.01;
      
      if (!address || !amount) {
        log('Please enter address and amount');
        return;
      }
      
      log(`Sending ${amount} XFG to ${address}...`);
      const result = await electronAPI.sendTransaction({ address, amount, fee });
      
      if (result.status === 'success') {
        log(`Transaction sent! Hash: ${result.transactionHash}`);
        document.getElementById('sendAddress').value = '';
        document.getElementById('sendAmount').value = '';
        setTimeout(refresh, 2000);
        setTimeout(loadTransactions, 3000);
      } else {
        log(`Error: ${result.message}`);
      }
    }

    // Load transactions
    async function loadTransactions() {
      const result = await electronAPI.getTransactions(50);
      const txList = document.getElementById('transactionList');
      
      if (result.transactions && result.transactions.length > 0) {
        txList.innerHTML = result.transactions.map(tx => `
          <div class="transaction-item">
            <div class="tx-info">
              <div class="tx-hash">${tx.hash}</div>
              <div class="tx-details">
                Block: ${tx.blockHeight} ‚Ä¢ ${tx.confirmations} confirmations ‚Ä¢ Fee: ${tx.fee.toFixed(8)} XFG
              </div>
            </div>
            <div class="tx-amount ${tx.amount >= 0 ? 'positive' : 'negative'}">
              ${tx.amount >= 0 ? '+' : ''}${tx.amount.toFixed(8)} XFG
            </div>
          </div>
        `).join('');
      } else {
        txList.innerHTML = '<p style="opacity: 0.5;">No transactions yet</p>';
      }
    }

    // Show seed phrase
    async function showSeed() {
      const result = await electronAPI.getMnemonic();
      const seedDisplay = document.getElementById('seedDisplay');
      
      if (result.status === 'success') {
        seedDisplay.textContent = result.seed;
        seedDisplay.classList.remove('hidden');
        
        // Add save button
        if (!document.getElementById('saveSeedBtn')) {
          const saveBtn = document.createElement('button');
          saveBtn.id = 'saveSeedBtn';
          saveBtn.className = 'btn btn-secondary';
          saveBtn.textContent = 'üíæ Save to File';
          saveBtn.onclick = () => saveSeed(result.seed);
          seedDisplay.parentElement.appendChild(saveBtn);
        }
      } else {
        log('Error: ' + result.message);
      }
    }

    // Save seed to file
    async function saveSeed(seed) {
      const result = await electronAPI.saveFile({
        content: seed,
        filename: 'fuego-seed-phrase.txt'
      });
      
      if (result.status === 'success') {
        log('Seed phrase saved to: ' + result.path);
      }
    }

    // Export keys
    async function exportKeys() {
      const result = await electronAPI.exportKeys();
      
      if (result.status === 'success') {
        const content = `Fuego Wallet Keys\n==================\n\nView Key: ${result.viewKey}\nSpend Key: ${result.spendKey}\n\n‚ö†Ô∏è Keep these keys secure!`;
        
        const saveResult = await electronAPI.saveFile({
          content: content,
          filename: 'fuego-keys.txt'
        });
        
        if (saveResult.status === 'success') {
          log('Keys exported to: ' + saveResult.path);
        }
      } else {
        log('Error: ' + result.message);
      }
    }

    // Delete wallet
    async function deleteWallet() {
      const confirmed = await electronAPI.openDialog({
        type: 'warning',
        buttons: ['Cancel', 'Delete'],
        defaultId: 0,
        title: 'Delete Wallet',
        message: 'Are you sure you want to delete this wallet?',
        detail: 'This action cannot be undone. Make sure you have backed up your seed phrase and keys.'
      });
      
      if (confirmed.response === 1) {
        const result = await electronAPI.deleteWallet();
        log(result.message);
        
        if (result.status === 'success') {
          walletAddress = '';
          document.getElementById('addressText').textContent = 'No wallet loaded';
          document.getElementById('balanceAmount').textContent = '0.00 XFG';
          document.getElementById('balanceLocked').textContent = 'Locked: 0.00 XFG';
        }
      }
    }

    // Copy address
    function copyAddress() {
      if (walletAddress) {
        navigator.clipboard.writeText(walletAddress);
        log('Address copied to clipboard');
      }
    }

    // ==========================================
    // BURN2MINT Functions
    // ==========================================

    function setBurnAmount(amount) {
      document.getElementById('burnAmount').value = amount;
    }

    async function startBurn() {
      const amount = parseFloat(document.getElementById('burnAmount').value);
      
      if (!amount || amount < 0.8) {
        log('Minimum burn amount is 0.8 XFG');
        return;
      }

      log(`Creating burn deposit: ${amount} XFG...`);
      const result = await electronAPI.createBurnDeposit(amount);

      if (result.status === 'success') {
        currentBurnTx = result.txHash;
        log(`‚úÖ Burn deposit created: ${result.txHash}`);
        log(`Waiting for confirmations...`);
        
        // Show step 2
        document.getElementById('step2').classList.remove('hidden');
        
        // Wait a bit then enable step 2
        setTimeout(() => {
          log('‚úÖ Transaction confirmed. Ready for Elderfier consensus.');
        }, 5000);
      } else {
        log(`‚ùå Error: ${result.message}`);
      }
    }

    async function requestConsensus() {
      if (!currentBurnTx) {
        log('‚ùå No burn transaction found');
        return;
      }

      const amount = parseFloat(document.getElementById('burnAmount').value);
      log('Requesting Elderfier consensus...');

      const result = await electronAPI.requestElderfierConsensus({
        txHash: currentBurnTx,
        amount: amount
      });

      if (result.status === 'success') {
        currentEldernodeProof = result.eldernodeProof;
        log(`‚úÖ Elderfier consensus received`);
        log(`Proof: ${currentEldernodeProof}`);
        
        // Show step 3
        document.getElementById('step3').classList.remove('hidden');
      } else {
        log(`‚ùå Error: ${result.message}`);
      }
    }

    async function generateProof() {
      if (!currentBurnTx || !currentEldernodeProof) {
        log('‚ùå Missing burn transaction or consensus proof');
        return;
      }

      const amount = parseFloat(document.getElementById('burnAmount').value);
      log('Generating STARK proof with xfg-stark CLI...');

      const result = await electronAPI.generateStarkProof({
        txHash: currentBurnTx,
        amount: amount,
        eldernodeProof: currentEldernodeProof
      });

      if (result.status === 'success') {
        currentStarkProof = result.starkProof;
        log(`‚úÖ STARK proof generated successfully!`);
        
        // Display proof
        document.getElementById('proofDisplay').textContent = currentStarkProof;
        document.getElementById('step4').classList.remove('hidden');
      } else {
        log(`‚ùå Error: ${result.message}`);
        // Fallback message if xfg-stark not installed
        if (result.message.includes('not found')) {
          log('‚ö†Ô∏è  Please install xfg-stark CLI to generate proofs');
          log('   Or manually run: xfg-stark generate-proof \\');
          log(`     --tx-hash ${currentBurnTx} \\`);
          log(`     --amount ${Math.floor(amount * 100000000)} \\`);
          log(`     --eldernode-proof ${currentEldernodeProof}`);
        }
      }
    }

    async function saveProof() {
      if (!currentStarkProof) {
        log('‚ùå No proof to save');
        return;
      }

      const amount = parseFloat(document.getElementById('burnAmount').value);
      const content = `Fuego Burn2Mint STARK Proof
=============================

Burn Amount: ${amount} XFG
Transaction: ${currentBurnTx}
Eldernode Proof: ${currentEldernodeProof}

STARK Proof:
${currentStarkProof}

Next Steps:
1. Estimate L1 gas fees (0.001-0.01 ETH)
2. Submit to Arbitrum L2 contract: claimHEAT()
   - STARK proof (above)
   - Eldernode proof (above)
   - msg.value (L1 gas + 20% buffer)
3. Receive HEAT on Ethereum L1

‚ö†Ô∏è  Include 20% gas buffer to avoid restart costs!
`;

      const result = await electronAPI.saveFile({
        content: content,
        filename: `burn2mint-proof-${currentBurnTx.substring(0, 8)}.txt`
      });

      if (result.status === 'success') {
        log(`‚úÖ Proof saved to: ${result.path}`);
      }
    }

    async function loadBurnHistory() {
      const result = await electronAPI.getBurnHistory(20);
      const list = document.getElementById('burnHistoryList');

      if (result.burns && result.burns.length > 0) {
        list.innerHTML = result.burns.map(burn => `
          <div class="transaction-item">
            <div class="tx-info">
              <div class="tx-hash">${burn.hash}</div>
              <div class="tx-details">
                Block: ${burn.blockHeight} ‚Ä¢ ${burn.confirmations} confirmations
              </div>
            </div>
            <div class="tx-amount negative">
              ${burn.amount.toFixed(8)} XFG
            </div>
          </div>
        `).join('');
      } else {
        list.innerHTML = '<p style="opacity: 0.5;">No burns yet</p>';
      }
    }

    // ==========================================
    // BANKING (CD) Functions
    // ==========================================

    // Standard CD terms
    const STANDARD_CD_TERM = 3;  // months
    const STANDARD_CD_APY = 8;   // percent
    const MIN_CD_AMOUNT = 80;    // XFG
    const CD_YIELD_RATE = 0.0000008; // CD per XFG (XFG / 1,250,000)

    function setCdAmount(amount) {
      document.getElementById('cdAmount').value = amount;
      updateCdPreview(amount);
    }

    function updateCdPreview(amount) {
      const cdYield = amount * CD_YIELD_RATE;

      document.getElementById('cdPreviewAmount').textContent = amount.toFixed(2);
      document.getElementById('cdPreviewInterest').textContent = cdYield.toFixed(6);
      document.getElementById('cdPreviewTotal').textContent = amount.toFixed(2);
      document.getElementById('cdPreview').classList.remove('hidden');
    }

    // Update preview when amount changes
    document.addEventListener('DOMContentLoaded', () => {
      const cdAmountInput = document.getElementById('cdAmount');
      if (cdAmountInput) {
        cdAmountInput.addEventListener('input', (e) => {
          const amount = parseFloat(e.target.value);
          if (amount && amount >= MIN_CD_AMOUNT) {
            updateCdPreview(amount);
          } else {
            document.getElementById('cdPreview').classList.add('hidden');
          }
        });
      }
    });

    async function createCd() {
      const amount = parseFloat(document.getElementById('cdAmount').value);

      if (!amount || amount < MIN_CD_AMOUNT) {
        log(`‚ùå Minimum CD deposit is ${MIN_CD_AMOUNT} XFG`);
        log(`   Accepted amounts: 80, 800, or 8000 XFG`);
        return;
      }

      // Validate specific amounts
      const validAmounts = [80, 800, 8000];
      if (!validAmounts.includes(amount)) {
        log(`‚ùå Invalid amount. Please use: 80, 800, or 8000 XFG`);
        return;
      }

      log(`Creating 3-month CD deposit: ${amount} XFG @ 8% APY...`);
      const result = await electronAPI.createCdDeposit({ 
        amount, 
        term: STANDARD_CD_TERM 
      });

      if (result.status === 'success') {
        const cdYield = (amount * CD_YIELD_RATE).toFixed(6);
        log(`‚úÖ CD deposit created: ${result.txHash}`);
        log(`   Deposit: ${amount} XFG for 3 months @ 8% APY`);
        log(`   Expected yield: ${cdYield} CD after 3 months`);
        
        // Clear form
        document.getElementById('cdAmount').value = '';
        document.getElementById('cdPreview').classList.add('hidden');

        // Reload deposits
        setTimeout(loadCdDeposits, 2000);
      } else {
        log(`‚ùå Error: ${result.message}`);
      }
    }

    async function loadCdDeposits() {
      const result = await electronAPI.getCdDeposits();
      const list = document.getElementById('cdDepositsList');

      if (result.deposits && result.deposits.length > 0) {
        list.innerHTML = result.deposits.map(deposit => {
          const isLocked = deposit.locked;
          const statusColor = isLocked ? '#FF6B35' : '#4CAF50';
          const statusText = isLocked ? 'üîí Locked' : '‚úÖ Mature';
          const cdYield = (deposit.amount * CD_YIELD_RATE).toFixed(6);
          
          return `
            <div class="transaction-item" style="border-left: 3px solid ${statusColor};">
              <div class="tx-info">
                <div class="tx-hash">${deposit.creatingTransactionHash}</div>
                <div class="tx-details">
                  ${statusText} ‚Ä¢ ${deposit.term || 3} months ‚Ä¢ Block ${deposit.height} ‚Üí ${deposit.unlockHeight}
                </div>
              </div>
              <div style="text-align: right;">
                <div class="tx-amount positive">
                  ${deposit.amount.toFixed(2)} XFG
                </div>
                <div style="font-size: 12px; opacity: 0.7; margin-top: 4px;">
                  +${cdYield} CD yield
                </div>
                ${!isLocked ? `
                  <button class="btn btn-secondary btn-small" onclick="withdrawCd(${deposit.id})" style="margin-top: 8px;">
                    Withdraw
                  </button>
                ` : ''}
              </div>
            </div>
          `;
        }).join('');
      } else {
        list.innerHTML = '<p style="opacity: 0.5;">No active CDs</p>';
      }
    }

    async function withdrawCd(depositId) {
      const confirmed = await electronAPI.openDialog({
        type: 'question',
        buttons: ['Cancel', 'Withdraw'],
        defaultId: 0,
        title: 'Withdraw CD',
        message: 'Withdraw this CD deposit?',
        detail: 'Your principal + interest will be returned to your wallet.'
      });

      if (confirmed.response === 1) {
        log(`Withdrawing CD deposit #${depositId}...`);
        const result = await electronAPI.withdrawCdDeposit(depositId);

        if (result.status === 'success') {
          log(`‚úÖ CD withdrawn: ${result.txHash}`);
          setTimeout(loadCdDeposits, 2000);
          setTimeout(refresh, 3000);
        } else {
          log(`‚ùå Error: ${result.message}`);
        }
      }
    }

    // Update node status indicator
    function updateNodeStatus(running) {
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');
      
      if (running) {
        dot.classList.add('active');
        text.textContent = 'Node Running';
      } else {
        dot.classList.remove('active');
        text.textContent = 'Node Offline';
      }
    }

    // Log message
    function log(message) {
      const logs = document.getElementById('logs');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logs.appendChild(entry);
      logs.scrollTop = logs.scrollHeight;
    }

    // Listen to events
    electronAPI.onNodeLog((data) => {
      log(`[NODE] ${data.trim()}`);
    });

    electronAPI.onNodeError((data) => {
      log(`[ERROR] ${data.trim()}`);
    });

    electronAPI.onNodeStopped(() => {
      log('Node stopped');
      updateNodeStatus(false);
    });

    electronAPI.onNodeReady(() => {
      log('Node ready!');
      updateNodeStatus(true);
    });

    electronAPI.onWalletReady(() => {
      log('Wallet ready!');
      refresh();
    });

    electronAPI.onWalletInfo((data) => {
      if (data.hasWallet && data.address) {
        walletAddress = data.address;
        document.getElementById('addressText').textContent = walletAddress;
        log(`Wallet loaded: ${walletAddress}`);
      }
    });

    // Auto-refresh every 5 seconds
    setInterval(() => {
      if (nodeRunning) {
        refresh();
      }
    }, 5000);

    // Initial load
    log('Fuego Wallet ready');
  </script>
</body>
</html>
